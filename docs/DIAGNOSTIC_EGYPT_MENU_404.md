# Диагностика: нерабочие страницы и пропавшие ссылки в меню (888starzeg-egypt.com)

## Что было сломано

- На **https://888starzeg-egypt.com** (Egypt) после деплоя:
  - часть страниц не открывалась (404): `/contacts/`, `/about/`, `/terms/`, `/responsible/`, `/privacy-policy/`, `/self-exclusion/`, `/dispute-resolution/`, `/fairness-rng-testing-methods/`, `/accounts-withdrawals-and-bonuses/`, `/promo-code/`;
  - в меню на страницах (в т.ч. на `/promo-code/`) не было ссылок на эти разделы.

## Причина

В **GitHub Actions** (`.github/workflows/deploy.yml`) статика собиралась с **другого домена**, чем тот, на который шёл деплой:

| Шаг | Было | Стало |
|-----|------|--------|
| **Краул (источник HTML)** | `STATIC_BASE_URL: "https://888starz-africa.com"` (Africa) | `STATIC_BASE_URL: "https://888starzeg-egypt.com"` (Egypt) |
| **Деплой (куда выкладываем)** | `888starzeg-egypt.com/public_html` (Egypt) | без изменений |

Итог: на Egypt выкладывался **статический снимок сайта Africa**. У Africa могло быть другое меню, другой набор страниц или другая вёрстка. Поэтому на Egypt после деплоя оказывалось «чужое» меню и не те страницы — ссылки из футера/хедера пропадали или вели на несуществующие URL.

**Оптимизатор HTML (`optimize-html-performance.js`) ссылки из меню не трогает** — он не удаляет и не меняет `<a href="...">`. Меню ломалось из‑за несовпадения источника краула и домена деплоя.

## Что сделано

1. **В `.github/workflows/deploy.yml`**  
   Для сборки статики при деплое на Egypt задаётся:
   - `STATIC_BASE_URL: "https://888starzeg-egypt.com"`  
   Краулится тот же сайт, на который потом идёт деплой. Меню и набор страниц в `dist/` соответствуют Egypt.

2. **В `scripts/export-crawler.js`**  
   В список системных страниц, которые всегда добавляются в очередь краула (даже если на них нет ссылок в меню), добавлен **`promo-code`**.  
   Итоговый список:  
   `about`, `contacts`, `terms`, `responsible`, `privacy-policy`, `self-exclusion`, `dispute-resolution`, `fairness-rng-testing-methods`, `accounts-withdrawals-and-bonuses`, **`promo-code`**.

## Как проверить после следующего деплоя

1. Открыть **https://888starzeg-egypt.com** и перейти по ссылкам в футере:  
   «من نحن», «معلومات الاتصال», «شروط الاستخدام», «اللعب المسؤول», «الخصوصية وإدارة البيانات», «الاستبعاد الذاتي», «حل النزاعات», «طرق اختبار النزاهة والعشوائية», «الحسابات والمدفوعات والمكافآت».
2. Проверить **https://888starzeg-egypt.com/promo-code/** — страница должна открываться, в меню/футере должны быть те же ссылки.
3. Убедиться, что все перечисленные URL открываются без 404.

## Важно для будущего

- Если будет отдельный деплой на **888starz-africa.com**, в workflow для него нужно задать `STATIC_BASE_URL: "https://888starz-africa.com"` (краулить Africa при деплое на Africa).
- **Правило:** `STATIC_BASE_URL` при деплое должен указывать на тот же сайт (домен), на который выкладывается статика. Иначе меню и страницы будут с «чужого» домена и появятся 404 и пропавшие ссылки.
- **Первый деплой после фикса:** в момент запуска workflow сайт **888starzeg-egypt.com** должен быть доступен (отдавать 200 и полное меню). Иначе краулер получит пустые или битые страницы. Если Egypt сейчас в 404 — сначала восстанови его (бэкап/ручная выкладка), потом делай push и деплой.
